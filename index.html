<!DOCTYPE html>
<head>
<meta charset="utf-8">
  <meta charset="UTF-8" />
<link rel="stylesheet" href="css/style.css">
<script src="js/d3.v4.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dimple/2.3.0/dimple.latest.min.js"></script>


</head>
<style>
  body {
   font: 10.5px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: black;
  }

  .axis path { stroke: none; }

  .node rect {
    cursor: move;
    fill-opacity: .9;
    shape-rendering: crispEdges;
  }

  .node text {
    pointer-events: none;
    font-family: Helvetica;
    font-size: 12px;
  }
</style>

  <nav>
        <ul>
          <li><a href="composer.html">Composer</a></li>
          <li><a href="linechart.html">Linechart</a></li>

        </u>
  </nav>
<div id="piece_viz"></div>
<div id="composer_viz"></div>
<div id="linechart"></div>
<div id="beechart_viz"></div>
<div id='sankey'>
<body>



<script>

// set the dimensions and margins of the graph
var margin = {top: 20, right: 00, bottom: 40, left: 205},
    width = 900 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
// append the svg object to the body of the page
var svg = d3.select("#piece_viz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

d3.csv("https://raw.githubusercontent.com/Mackmiller/DDJ/master/data/top_pieces.csv", function(data) {

//x axis
  var x = d3.scaleLinear()
    .domain([0, 50])
    .range([ 0, width]);
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x))
    .selectAll("text")
      .attr("transform", "translate(-10,0)rotate(-45)")
      .style("text-anchor", "end");

  // Y axis
  var y = d3.scaleBand()
    .range([ 0, height ])
    .domain(data.map(function(d) { return d.Piece; }))
    .padding(.1);

  svg.append("g")
    .attr("class", "axisWhite")
    .call(d3.axisLeft(y).tickSize(0))


  //Bars
  svg.selectAll("myRect")
    .data(data)
    .enter()
    .append("rect")
    .attr("x", x(0) )
    .attr("y", function(d) { return y(d.Piece); })
    .attr("width", function(d) { return x(d.Value); })
    .attr("height", y.bandwidth() )
    .attr("fill", "#A9261C")
})


var svg2 = d3.select("#composer_viz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

d3.csv("https://raw.githubusercontent.com/Mackmiller/DDJ/master/data/top_composers.csv", function(data) {

//x axis
  var x = d3.scaleLinear()
    .domain([0, 300])
    .range([ 0, width]);
  svg2.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).ticks(4))
    .selectAll("text")
      .attr("transform", "translate(-10,0)rotate(-45)")
      .style("text-anchor", "end");

  // Y axis
  var y = d3.scaleBand()
    .range([ 0, height ])
    .domain(data.map(function(d) { return d.Composer; }))
    .padding(.1);

  svg2.append("g")
    .attr("class", "axisWhite")
    .call(d3.axisLeft(y).tickSize(0))


  //Bars
  svg2.selectAll("myRect")
    .data(data)
    .enter()
    .append("rect")
    .attr("x", x(0) )
    .attr("y", function(d) { return y(d.Composer); })
    .attr("width", function(d) { return x(d.Value); })
    .attr("height", y.bandwidth() )
    .attr("fill", "#A9261C")
})

var general=[
  {"Year": "1930-01-01",
   "Movie Count": 1},

 {"Year": "1931-02-01",
   "Movie Count": 6},

 { "Year": "1932-03-01",
   "Movie Count": 2},

 { "Year": "1935-04-01",
   "Movie Count": 1},

 {"Year": "1936-05-01",
   "Movie Count": 3},

 {"Year": "1937-06-01",
   "Movie Count": 3},

 {"Year": "1938-07-01",
   "Movie Count": 1},

 {"Year": "1939-08-01",
  "Movie Count": 2},

 {"Year": "1940-09-01",
 "Movie Count": 12},

 {"Year": "1941-10-01",
 "Movie Count": 3},

 {"Year": "1942-11-01",
 "Movie Count": 4},

 {"Year": "1943-12-01",
 "Movie Count": 1},

 {"Year": "1944-01-01",
 "Movie Count": 3},

{"Year": "1945-02-01",
 "Movie Count": 2},

{"Year": "1946-03-01",
 "Movie Count": 13},

{"Year": "1947-04-01",
 "Movie Count": 2},

{"Year": "1948-05-01",
 "Movie Count": 9},

{"Year": "1949-06-01",
 "Movie Count": 1},

{"Year": "1950-07-01",
 "Movie Count": 2},

{"Year": "1951-08-01",
 "Movie Count": 8},

{"Year": "1954-09-01",
"Movie Count": 9},

{"Year": "1955-10-01",
"Movie Count": 4},

{"Year": "1956-11-01",
"Movie Count": 6},

{"Year": "1958-12-01",
"Movie Count": 4},

{"Year": "1959-01-01",
"Movie Count": 3},

{"Year": "1960-02-01",
"Movie Count": 1},

{"Year": "1961-03-01",
"Movie Count": 4},

{"Year": "1962-04-01",
"Movie Count": 7},

{"Year": "1963-05-01",
"Movie Count": 4},

{"Year": "1964-06-01",
"Movie Count": 3},

{"Year": "1965-07-01",
"Movie Count": 4},

{"Year": "1966-08-01",
"Movie Count": 4},

{"Year": "1967-09-01",
"Movie Count": 4},

{"Year": "1968-10-01",
"Movie Count": 10},

{"Year": "1969-11-01",
"Movie Count": 2},

{"Year": "1970-12-01",
"Movie Count": 10},

{"Year": "1971-01-01",
"Movie Count": 18},

{"Year": "1972-02-01",
"Movie Count": 7},

{"Year": "1973-03-01",
"Movie Count": 18},

{"Year": "1974-04-01",
"Movie Count": 9},

{"Year": "1975-05-01",
"Movie Count": 25},

{"Year": "1976-06-01",
"Movie Count": 8},

{"Year": "1977-07-01",
"Movie Count": 12},

{"Year": "1978-08-01",
"Movie Count": 13},

{"Year": "1979-09-01",
"Movie Count": 25},

{"Year": "1980-10-01",
"Movie Count": 33},

{"Year": "1981-11-01",
"Movie Count": 20},

{"Year": "1982-12-01",
"Movie Count": 19},

{"Year": "1983-01-01",
"Movie Count": 21},

{"Year": "1984-02-01",
"Movie Count": 36},

{"Year": "1985-03-01",
"Movie Count": 45},

{"Year": "1986-04-01",
"Movie Count": 16},

{"Year": "1987-05-01",
"Movie Count": 51},

{"Year": "1988-06-01",
"Movie Count": 40},

{"Year": "1989-07-01",
"Movie Count": 41},

{"Year": "1990-08-01",
"Movie Count": 52},

{"Year": "1991-09-01",
"Movie Count": 60},

{"Year": "1992-10-01",
"Movie Count": 78},

{"Year": "1993-11-01",
"Movie Count": 112},

{"Year": "1994-12-01",
"Movie Count": 132},

{"Year": "1995-01-01",
"Movie Count": 119},

{"Year": "1996-02-01",
"Movie Count": 131},

{"Year": "1997-03-01",
"Movie Count": 142},

{"Year": "1998-04-01",
"Movie Count": 136},

{"Year": "1999-05-01",
"Movie Count": 166},

{"Year": "2000-06-01",
"Movie Count": 109},

{"Year": "2001-07-01",
"Movie Count": 120},

{"Year": "2002-08-01",
"Movie Count": 98},

{"Year": "2003-09-01",
"Movie Count": 63},

{"Year": "2004-10-01",
"Movie Count": 16},

{"Year": "2005-11-01",
"Movie Count": 4},

{"Year": "2006-12-01",
"Movie Count": 5},

{"Year": "2007-01-01",
"Movie Count": 3},

{"Year": "2008-02-01",
"Movie Count": 7},

{"Year": "2009-03-01",
"Movie Count": 23},

{"Year": "2010-04-01",
"Movie Count": 10},

{"Year": "2011-05-01",
"Movie Count": 16},

{"Year": "2012-06-01",
"Movie Count": 86},

{"Year": "2013-07-01",
"Movie Count": 71},

{"Year": "2014-08-01",
"Movie Count": 94},

{"Year": "2015-09-01",
"Movie Count": 226},

{"Year": "2016-10-01",
"Movie Count": 105},

{"Year": "2017-11-01",
"Movie Count": 57},

{"Year": "2018-12-01",
"Movie Count": 27},

{"Year": "2019-01-01",
"Movie Count": 4}


];



	var svg3 = dimple.newSvg("#linechart","950", "400");
	var myChart = new dimple.chart(svg3, general);
    //myChart.setBounds(80, 40, "75%", "60%");
	var x = myChart.addTimeAxis("x", "Year","%Y-%m-%d","%Y");
	x.showGridlines = true;
  x.timeField = "Year";
  var y =myChart.addMeasureAxis("y", "Movie Count");
  y.title = "Number of Movies";
    /*x.hidden = true;*/
x.timeInterval = 10;
y.ticks = 5;


	/*y.showGridlines=true;*/
  var s = myChart.addSeries(null, dimple.plot.line,[x,y]);
	//s.lineWeight=4;

  //myChart.addLegend(60, 10, 500, 20, "right");
  myChart.defaultColors = [
     new dimple.color("#a9261c", "#a9261c", 1), // red
 ];

/*myChart.setMargins("50%", "10px", "10px", "20px");*/
/*myChart.setMargins("20%", "10px", "50%", "20px");*/
myChart.setMargins("10%", "10px", "25%", "20px");

x.lineWeight = 0;


	//s.lineMarkers=true;
    myChart.draw(1500);

    window.onresize = function () {
                          myChart.draw(0, true);
                        };


</script>
<script src="js/d3-v3.js"></script>
<script src="js/force-chart.js"></script>

 <script>
   var margin = { top: 10, left: 220, bottom: 30, right: 50 },
       width = 800 - margin.left - margin.right,
       height = 600 - margin.top - margin.bottom;

 var x = function(d) { return d.rating; },
       y = function(d) { return d.genre; },
       area = function(d) { return d.budget; };

   var xScale = d3v3.scale.linear()
         .domain([1930, 2020])
         .range([0, width]),
       yScale = d3v3.scale.ordinal()
         .domain(["Rigoletto: La donna e mobile", "Toccata and Fugue in D minor", "Nocturne No. 2 in E-flat major", "Ride of the Valkyries", "Pomp and Circumstance Military March No.1", "Messiah: Hallelujah", "William Tell: Overture", "A Midsummer Night's Dream: Wedding March", "Lohengrin: Bridal Chorus", "The Blue Danube"])
         .rangeBands([height, 0]),
       areaScale = d3v3.scale.linear().range([0, 125]),
       colorScale = d3v3.scale.quantize()
        .domain([1930, 2020])
        .range(["#a9261c"]);

   var xValue = function(d) { return xScale(x(d)); },
       yValue = function(d) { return yScale(y(d)) + yScale.rangeBand()/2; },
       rValue = function(d) {
         var A = 60;
         return Math.sqrt(A / Math.PI);
       },
       colorValue = function(d) { return colorScale(x(d)); };

   var xAxis = d3v3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3v3.format('d')),
       yAxis = d3v3.svg.axis().scale(yScale).orient("left");

   var bubbleChart = d3v3.forceChart()
    .size([width, height])
    .x(xValue)
    .y(yValue)
    .r(rValue)
    .xGravity(3)    // make the x-position more accurate
    .yGravity(1/3); // ...and the y-position more flexible

    var svg4 = d3v3.select("#beechart_viz")
   .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

   d3v3.json("data/movies.json", function(error, movies) {
     if (error) throw error;

     areaScale.domain([0,d3v3.max(movies, area)]);

     // Draw axes
     svg4.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + 550 + ")")
        .call(xAxis)
      .append("text")
        .attr("dx", width)
        .attr("dy", -6)
        .style("text-anchor", "end")



     svg4.append("g")
        .attr("class", "y axis")
        .call(yAxis)
      .selectAll(".tick line")
        .attr("x2", width)
        .attr("stroke-dasharray", "1, 2")
        .style("stroke", "lightgrey");

     // Draw legend


     // Draw bubbles
     svg4.append("g").call(bubbleChart, movies)
        .attr("class", "bubbles")
      .selectAll(".node").append("circle")
        .attr("r", function(d) { return d.r0; })
        .attr("fill", colorValue)

   });

   function legend(selection) {
     var legendData = [
       { budget: 200000000, text: "$200 million", dy: 0 },
       { budget: 100000000, text: "$100 million", dy: 20 },
       { budget: 50000000, text: "$50 million", dy: 40 },
       { budget: 10000000, text: "$10 million", dy: 60 }
     ];



     legend.selectAll(".item").data(legendData)
      .enter().append("g")
        .attr("transform", function(d) { return "translate(0," + d.dy + ")"; })
        .each(function(d) {
          d3v3.select(this).append("circle")
            .attr("r", rValue(d))
            .style("fill", "none")
            .style("stroke", "slategrey");
          d3v3.select(this).append("text")
            .attr("dx", 10)
            .attr("dy", 4)
            .text(d.text);
        });
   }
 </script>
 <script src='js/sankey.js'></script>
 <script src='https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.19.0/babel.min.js'></script>
 <script lang='babel' type='text/babel'>
 const units = '';
 const margin = {top: 10, right: 10, bottom: 10, left: 10};
 const width = 750 - margin.left - margin.right;
 const height = 300 - margin.top - margin.bottom;

 // zero decimal places
 const formatNumber = d3.format(',.0f');

 const format = d => `${formatNumber(d)} ${units}`;

 const color = d3.scaleOrdinal()
   .domain([
   'Drama',
     'Biography',
     'Music',
     'Comedy',
     'History',
     'Fantasy',
     'Thriller'
   ])
   .range([
     '#90eb9d',
     '#f9d057',
     '#f29e2e',
     '#00ccbc',
     '#56307E',
     '#E271C1',
     '#534635'
   ]);

 d3.select('#chart')
   .style('visibility', 'visible');

 // append the svg canvas to the page
 const svg5 = d3.select('#sankey').append('svg')
   .attr('width', width + margin.left + margin.right)
   .attr('height', height + margin.top + margin.bottom)
   .append('g')
     .attr('transform', `translate(${margin.left},${margin.top})`);

 // set the sankey diagram properties
 const sankey = d3.sankey()
   .nodeWidth(6)
   .nodePadding(10)
   .size([width, height]);

 const path = sankey.link();

 // append a defs (for definition) element to your SVG
 const defs = svg5.append('defs');

 // load the data
 d3.json('data/data.json', (error, graph) => {
   console.log('graph', graph);
   sankey
     .nodes(graph.nodes)
     .links(graph.links)
     .layout(13); // any value > 13 breaks the link gradient

   // add in the links
   const link = svg5.append('g').selectAll('.link')
     .data(graph.links)
     .enter().append('path')
       .attr('class', 'link')
       .attr('d', path)
       .style('stroke-width', d => Math.max(1, d.dy))
       .style('fill', 'none')
       .style('stroke-opacity', 0.18)
       .sort((a, b) => b.dy - a.dy)
       .on('mouseover', function() {
         d3.select(this).style('stroke-opacity', 0.5);
       })
       .on('mouseout', function() {
         d3.select(this).style('stroke-opacity', 0.2);
       });

   // add the link titles
   link.append('title')
     .text(d => `${d.source.name} → ${d.target.name}\n${format(d.value)}`);

   // add in the nodes
   const node = svg5.append('g').selectAll('.node')
     .data(graph.nodes)
     .enter().append('g')
       .attr('class', 'node')
       .attr('transform', d => `translate(${d.x},${d.y})`)
       .call(d3.drag()
         .subject(d => d)
         .on('start', function() {
           this.parentNode.appendChild(this); })
         .on('drag', dragmove));

   // add the rectangles for the nodes
   node.append('rect')
     .attr('height', d => d.dy)
     .attr('width', sankey.nodeWidth())
     .style('fill', d => {
       if(color.domain().indexOf(d.name) > -1){
         return d.color = color(d.name);
       } else {
         return d.color = '#A9261C'; //ccc
       }
     })
     .append('title')
       .text(d => `${d.name}\n${format(d.value)}`);

   // add in the title for the nodes
   node.append('text')
     .attr('x', -6)
     .attr('y', d => d.dy / 2)
     .attr('dy', '.35em')
     .attr('text-anchor', 'end')
     .attr('transform', null)
     .text(d => d.name)
     .filter(d => d.x < width / 2)
       .attr('x', 6 + sankey.nodeWidth())
       .attr('text-anchor', 'start');

   // add gradient to links
   link.style('stroke', (d, i) => {
     console.log('d from gradient stroke func', d);

     // make unique gradient ids
     const gradientID = `gradient${i}`;

     const startColor = d.source.color;
     const stopColor = d.target.color;

     console.log('startColor', startColor);
     console.log('stopColor', stopColor);

     const linearGradient = defs.append('linearGradient')
         .attr('id', gradientID);

     linearGradient.selectAll('stop')
       .data([
           {offset: '10%', color: startColor },
           {offset: '90%', color: stopColor }
         ])
       .enter().append('stop')
       .attr('offset', d => {
         console.log('d.offset', d.offset);
         return d.offset;
       })
       .attr('stop-color', d => {
         console.log('d.color', d.color);
         return d.color;
       });

     return `url(#${gradientID})`;
   })

 // the function for moving the nodes
   function dragmove(d) {
     d3.select(this).attr('transform',
       `translate(${d.x = Math.max(0, Math.min(width - d.dx, d3.event.x))},${d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))})`);
     sankey.relayout();
     link.attr('d', path);
   }
 });
 </script>



</body>
</html>
